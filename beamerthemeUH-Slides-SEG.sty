%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% UH-Slides-SEG
%%   Revised by Yuchen Jin (cainmagi)
%%   Feb. 4, 2019
%%   A template for attending the SEG meeting.
%% ----------------
%% - Adapted from the Lund Beamer template.
%% - Specially designed for SEG 2018.
%% - Support both 4:3 and 16:9 modes.
%% - Support two logos.
%% - A totally new thanks page.
%% - Support with necessary packages.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ProvidesPackage{beamerthemeUH-Slides-SEG}[2021/08/12]
\RequirePackage{ifthen}
\RequirePackage{tikz,pgf}
\RequirePackage[overload]{textcase}
\RequirePackage{setspace}
%\usepackage[urw-garamond]{mathdesign}
\RequirePackage[T1]{fontenc}
\RequirePackage[rm]{roboto}
\RequirePackage{roboto-mono}
\RequirePackage{csquotes}
\RequirePackage[style=ieee,citestyle=verbose,backend=bibtex]{biblatex}
\RequirePackage{cleveref}
\RequirePackage{algorithm}
\RequirePackage{algorithmic}
\RequirePackage{float}
\RequirePackage{subfigure}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\crefname{subsection}{Subsection}{Subsections}
\def\thesubsection{\arabic{section}.\arabic{subsection}}

% Hotfix for cref
\let\chyperref\cref % Save the orginal command under a new name
\renewcommand{\cref}[1]{\hyperlink{#1}{\chyperref{#1}}} % Redefine the \cref command and explictely add the hyperlink.

% Hotfix for footnotes
\let\oldfootnote\footnote
\renewcommand\footnote[1]{\oldfootnote[frame]{\scriptsize #1}}

\RequirePackage{ifxetex}
\ifpdf
  \RequirePackage{graphicx}
  \RequirePackage{epstopdf}
  \graphicspath{{Pics/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  \DeclareGraphicsExtensions{.pdf,.jpeg,.png,.jpg}
\else
  \ifxetex
    \RequirePackage{graphicx}
  \else
    \RequirePackage[dvipdfmx]{graphicx}
    \RequirePackage{bmpsize}
  \fi
  \graphicspath{{Pics/},{Pics2/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  \DeclareGraphicsExtensions{.eps,.pdf,.jpeg,.png,.jpg}
\fi

\RequirePackage{tcolorbox}
\tcbuselibrary{skins,hooks}
\usetikzlibrary{shadows}
\RequirePackage{tabularx}
\RequirePackage{array}
\RequirePackage{colortbl}

%\renewcommand{\rmdefault}{phv}
\usetikzlibrary{shapes,arrows,calc,positioning}

\definecolor{UHRed}{RGB}{200,16,46} %Kopparn som tydligen ska användas till typ allt 156,97,20
\definecolor{UHBlue}{RGB}{0,0,128} %Den ganska mörka blåa färgen som LU har, anänds inte så mycket längre
\definecolor{UHPink}{RGB}{233,196,199} %denna är någon sorts officiell rosa som man kan ha som accentfärg
\definecolor{UHPink}{RGB}{173,202,184} %Fler officiella accentfärger
\definecolor{UHLBlue}{RGB}{185,211,220}
\definecolor{UHIvory}{RGB}{255,255,234}

\definecolor{SEGNavy}{HTML}{2A2C63}
\definecolor{SEGBlue}{HTML}{3871C0}
\definecolor{SEGRed}{HTML}{E42629}
\definecolor{SEGYellow}{HTML}{F7A313}

\definecolor{IMAGEBlue}{HTML}{005DA3}
\definecolor{IMAGESemiBlue}{HTML}{008DB8}
\definecolor{IMAGESemiGreen}{HTML}{00B288}
\definecolor{IMAGEGreen}{HTML}{98C93C}

\newcommand{\titlecolor}[1]{\renewcommand{\giventitlecolor}{#1}}
\newcommand{\titleimage}[1]{\renewcommand{\giventitleimage}{#1}}
\newcommand{\giventitlecolor}{}
\newcommand{\giventitleimage}{}

\newcommand{\thankscolor}[1]{\renewcommand{\giventhankscolor}{#1}}
\newcommand{\thanksimage}[1]{\renewcommand{\giventhanksimage}{#1}}
\newcommand{\giventhankscolor}{}
\newcommand{\giventhanksimage}{}

%Babel support
\providecommand*{\SEGlogoTitle}{seg-2021-alt.png}
\providecommand*{\SEGlogo}{seg-2021.png}
\providecommand*{\UHlogo}{uh-logo.eps}

%Logo Settings
\newcommand{\titleLogo}[1]{
  \renewcommand{\SEGlogoTitle}{#1}
  \pgfdeclareimage[width=.16\paperwidth]{title-logo}{#1}
}

\newcommand{\firstLogo}[1]{
\renewcommand{\SEGlogo}{#1}
\pgfdeclareimage[width=.13\paperwidth]{small-logo}{#1}
}

\newcommand{\secondLogo}[1]{
\providecommand{\givenSecondLogo}{#1}
\pgfdeclareimage[width=.13\paperwidth]{second-logo}{#1}
}
%\newcommand{\givenSecondLogo}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Outer theme
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\useoutertheme[width=.15\paperwidth,right]{sidebar}
\setlength{\beamer@headheight}{.165\paperheight}
\pgfdeclareimage[width=.13\paperwidth]{small-logo}{\SEGlogo}
%\pgfdeclareimage[width=.5\paperwidth]{main-logo}{\SEGlogo}
%\pgfdeclareimage[width=.33\paperwidth]{large-corner}{large-corner}
%\pgfdeclareimage[height=\beamer@headheight]{small-corner}{small-corner}
\setbeamertemplate{sidebar right}{%
%\vskip7pt
\insertverticalnavigation{\beamer@sidebarwidth}%
}

\setbeamercolor{author in head/foot}{bg=IMAGEBlue,fg=white}
\setbeamercolor{title in head/foot}{bg=IMAGESemiBlue,fg=white}
\setbeamercolor{organization in head/foot}{bg=IMAGESemiGreen,fg=white}
\setbeamercolor{date in head/foot}{bg=IMAGEGreen,fg=white}

\setbeamertemplate{footline}{\leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.25\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertshortauthor
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.25\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
    \usebeamerfont{title in head/foot}\insertshorttitle
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.25\paperwidth,ht=2.25ex,dp=1ex,center]{organization in head/foot}%
    \usebeamerfont{organization in head/foot}\insertshortinstitute 
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.25\paperwidth,ht=2.25ex,dp=1ex,right]{date in head/foot}%
    \usebeamerfont{date in head/foot}\insertshortdate{}\hspace*{2em}
    \insertframenumber{} / \inserttotalframenumber\hspace*{2ex} 
  \end{beamercolorbox}}%
  \vskip0pt%
}
%\setbeamertemplate{footline}[text line]{%
%\insertshortauthor\strut\hfill\insertshorttitle\hfill\insertshortdate\hspace{1em}\insertframenumber/\inserttotalframenumber}

\addtobeamertemplate{frametitle}{}{%
\begin{pgfpicture}
\pgf@relevantforpicturesizefalse
\pgftransformxshift{-\Gm@lmargin}
\pgftransformyshift{\beamer@headheight-3ex}
\pgfpathmoveto{\pgfpoint{0.4em}{0pt}}
\pgfpathlineto{\pgfpoint{0.6\paperwidth}{0pt}}
\pgfsetlinewidth{1pt}
\pgfsetcolor{IMAGEBlue}
\pgfusepath{stroke}
\end{pgfpicture}%
\begin{pgfpicture}
\pgf@relevantforpicturesizefalse
\pgftransformxshift{-\Gm@lmargin}
\pgftransformyshift{\beamer@headheight+18pt}
%\pgftext[at=\pgfpoint{\paperwidth}{-\beamer@headheight},right,base]{\pgfuseimage{small-corner}}
\pgfpathmoveto{\pgfpoint{\paperwidth-.15\paperwidth}{0pt}}
\pgfpathlineto{\pgfpoint{\paperwidth-.15\paperwidth}{-\beamer@headheight}}
\pgfsetlinewidth{3.5pt}
\pgfsetinnerlinewidth{1pt}
\pgfsetinnerstrokecolor{IMAGEBlue}
\pgfsetcolor{white}
\pgfusepath{stroke}
\begin{tikzpicture}[remember picture,overlay]
  \node [rectangle, draw=none, left color=IMAGEBlue, right color=IMAGEGreen, anchor=north east, minimum width=\beamer@sidebarwidth-2pt+0.5px, minimum height=\beamer@headheight+0.5px] (box) at ([xshift=1px,yshift=1px] current page.north east){};
\end{tikzpicture}
\pgfpathmoveto{\pgfpoint{\paperwidth-.15\paperwidth}{-.18\paperheight}}
\pgfpathlineto{\pgfpoint{\paperwidth-.15\paperwidth}{-.97\paperheight}}
\pgfsetlinewidth{1pt}
\pgfsetinnerlinewidth{0pt}
\pgfsetcolor{IMAGEBlue}
\pgfusepath{stroke}
\pgftext[at=\pgfpoint{\paperwidth-.075\paperwidth}{-.95\paperheight},center,base]{\pgfuseimage{small-logo}}
\ifx\givenSecondLogo\undefined
\else
  \pgftext[at=\pgfpoint{\paperwidth-.075\paperwidth}{-.95\paperheight+1.3cm},center,base]{\pgfuseimage{second-logo}}
\fi
\end{pgfpicture}%
\vskip-25pt%
}



\setbeamertemplate{title page}{
\pgfdeclarelayer{text}    % declare background layer
\pgfsetlayers{main,text}  % set the order of the layers (main is the standard layer)

\begin{tikzpicture}%[overlay]

\ifx\giventitlecolor\@empty %check if there is a bg color set
	\draw[fill=UHPink, line width=.3cm, draw=white, use as bounding box] (0,0)
	rectangle (\paperwidth+0.012\paperwidth, 1\paperheight);
\else
	\draw[fill=\giventitlecolor, line width=.3cm, draw=white, use as bounding box] (0,0)
	rectangle (1\paperwidth+0.012\paperwidth, 1\paperheight);
\fi
	
\ifx\giventitleimage\@empty
	%if no title image do nothing
\else
	\begin{scope}
		\clip (.15, .15) rectangle ($(\paperwidth,\paperheight) - (-0.005\paperwidth, .15)$);
		\node[inner sep=0, anchor=south west, opacity=0.8] at (.15,.15) {\giventitleimage};
	\end{scope}
\fi


\renewcommand{\baselinestretch}{.9} %reduce line spacing

%draw subtitle if there is one
\begin{pgfonlayer}{text}
\ifx\insertsubtitle\@empty
  %if there is no subtitle, only draw the title.
  \node[anchor=center, minimum height=2.4cm, minimum width=0.5\paperwidth] at (.5\paperwidth, .5\paperheight) (titlebox) {
    \begin{tikzpicture}
      \usebeamerfont{title} %set font to title font
      \node[anchor=south, minimum height=1cm, align=center, inner xsep=.4cm, inner ysep=.2cm] (titlenode) {\inserttitle};
    \end{tikzpicture}
  };
\else
  \node[anchor=center, minimum height=2.4cm, minimum width=0.5\paperwidth] at (.5\paperwidth, .5\paperheight) (titlebox) {
    \begin{tikzpicture}
      \usebeamerfont{title} %set font to title font
      \node[anchor=south, minimum height=1cm, align=center, inner xsep=.4cm, inner ysep=.2cm, color=IMAGEBlue] (titlenode) {\inserttitle};
      \usebeamerfont{subtitle}
      \node[anchor=north, minimum height=.5cm, align=left, inner xsep=.4cm, inner ysep=.2cm, color=IMAGESemiBlue] at ($(titlenode.south)+(0,.03ex)$) (subtitlenode) {\MakeUppercase{\insertsubtitle}\\ \insertinstitute};
      \begin{scope}
        \draw[very thick, draw=IMAGEBlue] ($(titlenode.south west)+(0.3cm,0.1cm)$) -- ($(titlenode.south east)+(-0.3cm,0.1cm)$);
        \draw[very thick, draw=IMAGEBlue] ($(titlenode.south)-0.5*(subtitlenode.south east)+0.5*(subtitlenode.south west)+(0.3cm,0.1cm)$) -- ($(titlenode.south)+0.5*(subtitlenode.south east)-0.5*(subtitlenode.south west)+(-0.3cm,0.1cm)$);
      \end{scope}
    \end{tikzpicture}
  };
\fi
\end{pgfonlayer}

\begin{scope}
  \draw[very thick, draw=white, opacity=0.8] ($(titlebox.south east)-(.4\paperwidth,.2cm)$) -- ($(titlebox.south east)+(.2cm,-.2cm)$) -- ($(titlebox.south east)+(.2cm,2cm)$);
  \draw[very thick, draw=white, opacity=0.8] ($(titlebox.north west)-(.2cm,2cm)$) -- ($(titlebox.north west)-(.2cm,-.2cm)$) -- ($(titlebox.north west)+(.4\paperwidth,.2cm)$);
\end{scope}

%draw more white boxes
\draw[fill=white,draw=none, opacity=0.8] 
($(titlebox.south west)+(0,0)$) rectangle ($(titlebox.north east)+(0,0)$);

%draw the line to the edge of the page
\begin{scope}
  \clip (.15, .15) rectangle ($(\paperwidth,1\paperheight) - (-0.005\paperwidth, .15)$);
\end{scope}

%draw logos
\node[anchor=south east] at ($(\paperwidth,0)-(0.005\paperwidth, -.15)$) {\includegraphics[width=1.4in]{\SEGlogoTitle}};
\node[anchor=north west] at ($(0,\paperheight)-(0cm,0cm)$) {\includegraphics[width=0.75in]{\UHlogo}};
\end{tikzpicture}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Inner Theme
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\useinnertheme{rectangles}
\setbeamertemplate{navigation symbols}{}

\setlength{\leftmargini}{.5em}
\setlength{\leftmarginii}{1.0em}
\setlength{\leftmarginiii}{1.5em}
\setlength{\leftmarginiv}{2.0em}
\setlength{\leftmarginv}{2.5em}
\setlength{\leftmarginvi}{3.0em}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colours
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usecolortheme[named=IMAGEBlue]{structure}
\usecolortheme{rose}
\setbeamercolor{title page}{fg=IMAGEBlue}
\setbeamercolor{logo}{bg=IMAGEBlue}
\setbeamercolor{frametitle}{fg=IMAGEBlue,bg=white}
\setbeamercolor{section in sidebar}{fg=IMAGEBlue}
\setbeamerfont{section in sidebar}{series=\bfseries}
\setbeamercolor{block title}{bg=UHPink,fg=IMAGEBlue}
\setbeamercolor{block body}{bg=UHPink!50!white}
\setbeamercolor{block title alert}{bg=UHPink,fg=IMAGEBlue}
\setbeamercolor{block body alert}{bg=UHPink!50!white}
\setbeamercolor{block title example}{bg=UHPink,fg=IMAGEBlue}
\setbeamercolor{block body example}{bg=UHPink!50!white}
\setbeamerfont{title}{family={\rmfamily}, series={\bfseries}}
\setbeamerfont{subtitle}{family={\sffamily}, series={\bfseries}}
\setbeamerfont{frametitle}{family={\rmfamily}, series={\bfseries}}
\setbeamerfont{block title}{family={\rmfamily}, series={\bfseries}}
%\setbeamerfont{framesubtitle}{\uppercase}

\newcommand{\titleframe}{
\begingroup
\makeatletter
\setlength{\hoffset}{-\Gm@lmargin}
\makeatother
\begin{frame}[plain,shrink]
    \titlepage
\end{frame}
\endgroup
}

\newcommand{\ThankYouFrame}{
\begingroup
\makeatletter
\setlength{\hoffset}{-\Gm@lmargin}
\makeatother
\begin{frame}[plain,shrink]
\pgfdeclarelayer{text}    % declare background layer
\pgfsetlayers{main,text}  % set the order of the layers (main is the standard layer)
\begin{tikzpicture}

\ifthenelse{\equal{\giventhanksimage}{}}{
  \begin{scope}
    \draw[fill=\giventhankscolor, draw=none] (0,0) rectangle ($(\paperwidth,\paperheight)$);
  \end{scope}
}{
  \begin{scope}
    \clip (0, 0) rectangle ($(\paperwidth,\paperheight)$);
    \node[inner sep=0, anchor=south west] at (0,0) {\giventhanksimage};
    \node [rectangle, draw=none, left color=IMAGEBlue, right color=IMAGEGreen, anchor=south west, minimum width=\paperwidth+1px, minimum height=\paperheight+1px, opacity=0.5] (gradbox) at (0,0) {};
    \draw[fill=\giventhankscolor, draw=none, opacity=0.7] (0,0) rectangle ($(\paperwidth,\paperheight)$);
  \end{scope}
}

\renewcommand{\baselinestretch}{.9}

\begin{pgfonlayer}{text}
  \node[anchor=north west] at (.08\paperwidth, .7\paperheight) (thankbox) {
    \begin{tikzpicture}
      %draw thank text.
      \usebeamerfont{title}
      \node[minimum height=1cm, align=left, font=\LARGE, inner ysep=.2cm, inner xsep=.3cm] (thanksnode) {\bfseries \rmfamily \color{IMAGEBlue} Thank you for listening!}; 

      %draw sub thank text.
      \usebeamerfont{subtitle}   
      \node[align=left, anchor=text, inner xsep=.3cm, font=\normalsize] at ($(thanksnode.text)+(0,-.6cm)$)
      {\color{IMAGEBlue} \MakeUppercase{It's time for Q\&A.}};

      %draw the line to the edge of the page
      \begin{scope}
        \draw[very thick, draw=IMAGEBlue] ($(thanksnode.text)+(0,-.17cm)$) -- ($(thanksnode.text)+(thanksnode.east)-(thanksnode.west)+(-0.6cm,-.17cm)$);
      \end{scope}
    \end{tikzpicture}
  };
\end{pgfonlayer}

\draw[fill=white,draw=none, opacity=0.8] 
($(thankbox.south west)+(0,0)$) rectangle ($(thankbox.north east)+(0,0)$);

\end{tikzpicture}
\end{frame}
\endgroup
}

\setbeamertemplate{block begin}{
  \begin{tcolorbox}[title=\insertblocktitle, shadow={1mm}{-1mm}{0mm}{black!50!white}, enhanced, colback=UHIvory, colframe=IMAGEBlue, fonttitle=\bfseries, bottomrule=0pt, leftrule=0pt, rightrule=0pt, titlerule=3pt, toprule=3pt, top=3pt, bottom=3pt, left=1ex, right=1ex, arc=0pt, smart shadow arc=false]
  }
\setbeamertemplate{block end}{
  \end{tcolorbox}
}

\newenvironment{sectitle}{
  \begin{tcolorbox}[colback=red!5!white, colframe=red!75!black, sharp corners=downhill ]
}{
  \end{tcolorbox}
}

\hypersetup{pdfdisplaydoctitle={true}}
\ifpdf
  \hypersetup{pdfcreator={pdfLaTeX}}
\else
  \ifxetex
    \hypersetup{pdfcreator={xeLaTeX}}
  \else
    \hypersetup{pdfcreator={unknownLaTeX}}
  \fi
\fi

\hypersetup{
  pdfpagemode={FullScreen},
}