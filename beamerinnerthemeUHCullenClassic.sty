% This is the inner theme file of the UHCullen Classic theme.
%%
%% Copyright (c) 2022 by Yuchen Jin (cainmagi) <cainmagi@gmail.com>
%%
%% An unofficial template for UH Cullen Engineering Presentation
%% according to the official PPT version, see here:
%% https://www.egr.uh.edu/office-communications/resources
%% This template is used for providing title/final pages to UHCullen
%% Classic Theme.
%% -----------------------------
% Copyright info:
%
% Copyright (c) 2022 by Yuchen Jin (cainmagi) <cainmagi@gmail.com>
% Licensed by GNU General Public License at <http://www.gnu.org/licenses/>.
%
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
%
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerinnerthemeUHCullenClassic}[2022/12/07 v1.3.0 The UH Cullen Engineering Classic Theme]

\RequirePackage{ifthen}
\RequirePackage{ifxetex}
\RequirePackage{ifdraft}
\RequirePackage[overload]{textcase}
\RequirePackage{tikz}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{backgrounds}
\tikzfading[name=fade center, inner color=transparent!0, outer color=transparent!100]

% -----------------------------------------
% Theme options, definitions and templates.
% -----------------------------------------

% Define the builtin images.
\providecommand{\beamer@UHCullen@bgdecoratorl}{UHCullenGraphics/bgdecorator}
\providecommand{\beamer@UHCullen@bgdecoratoru}{UHCullenGraphics/bgdecorator-u}

% Define the default images.
\providecommand{\beamer@UHCullen@giventitleimageA}{\includegraphics[height=0.3\paperheight]{UHCullenGraphics/cullen-1}}
\providecommand{\beamer@UHCullen@giventitleimageB}{\includegraphics[height=0.3\paperheight]{UHCullenGraphics/cullen-2}}
\providecommand{\beamer@UHCullen@giventitleimageC}{\includegraphics[height=0.3\paperheight]{UHCullenGraphics/cullen-3}}
\providecommand{\beamer@UHCullen@givenfinalimage}{\includegraphics[height=\paperheight-0.9cm]{UHCullenGraphics/cullen-final}}
\providecommand{\beamer@UHCullen@giventitlelogo}{UHCullenGraphics/logo-cullen-color}
\providecommand{\beamer@UHCullen@givenfinallogo}{UHCullenGraphics/logo-cullen-long}

% Provide options for changing images.
\providecommand{\setTitleLogo}[1]{%
  \renewcommand{\beamer@UHCullen@giventitlelogo}{#1}
}
\providecommand{\setFinalLogo}[1]{%
  \renewcommand{\beamer@UHCullen@givenfinallogo}{#1}
}

\providecommand{\setTitleImageA}[2][]{%
  \ifthenelse{\equal{#1}{}}{
    \renewcommand{\beamer@UHCullen@giventitleimageA}{\includegraphics[height=0.3\paperheight]{#2}}
  }{
    \renewcommand{\beamer@UHCullen@giventitleimageA}{\includegraphics[#1]{#2}}
  }
}
\providecommand{\setTitleImageB}[2][]{%
  \ifthenelse{\equal{#2}{}}{
    \renewcommand{\beamer@UHCullen@giventitleimageB}{}
  }{
    \ifthenelse{\equal{#1}{}}{
      \renewcommand{\beamer@UHCullen@giventitleimageB}{\includegraphics[height=0.3\paperheight]{#2}}
    }{
      \renewcommand{\beamer@UHCullen@giventitleimageB}{\includegraphics[#1]{#2}}
    }
  }
}
\providecommand{\setTitleImageC}[2][]{%
  \ifthenelse{\equal{#2}{}}{
    \renewcommand{\beamer@UHCullen@giventitleimageC}{}
  }{
    \ifthenelse{\equal{#1}{}}{
      \renewcommand{\beamer@UHCullen@giventitleimageC}{\includegraphics[height=0.3\paperheight]{#2}}
    }{
      \renewcommand{\beamer@UHCullen@giventitleimageC}{\includegraphics[#1]{#2}}
    }
  }
}
\providecommand{\setFinalImage}[2][]{%
  \ifthenelse{\equal{#1}{}}{
    \renewcommand{\beamer@UHCullen@givenfinalimage}{\includegraphics[height=\paperheight-0.9cm]{#2}}
  }{
    \renewcommand{\beamer@UHCullen@givenfinalimage}{\includegraphics[#1]{#2}}
  }
}

% definitions for fonts of the different elements
\setbeamerfont{institute}{family=\sffamily, size=\normalsize}
\setbeamerfont{title}{family=\fontfamily{phv}, size=\LARGE}
\setbeamerfont{subtitle}{family=\sffamily, size=\large}
\setbeamerfont{frametitle}{size=\Large}
\setbeamerfont{framesubtitle}{size=\normalsize}
\setbeamerfont{author}{family=\sffamily, size=\normalsize}
\setbeamerfont{date}{family=\sffamily, size=\footnotesize}
\setbeamerfont{thanks}{parent=title, series=\bfseries}
\setbeamerfont{subthanks}{parent=title, series=\fontseries{m}}

% use numbers instead of a picture for the references
\setbeamertemplate{bibliography item}[text]

% define the height of the title figures
\newlength{\titlefigureheight}
\setlength{\titlefigureheight}{0.3\paperheight}

% title page
\setbeamertemplate{title page}{
  \begin{tikzpicture}
    \usebeamercolor{UHCullen}
    \usebeamercolor{UHBackground}
    \usebeamercolor{title body}
    % Bars and images
    \begin{scope}[on background layer]
      \draw[fill=none, draw=none, use as bounding box] (0,0)
      rectangle (\paperwidth, \paperheight);
      \draw[anchor=north west, fill=UHCullen.bg, draw=none] (0,\paperheight)
      rectangle (\paperwidth, 0.864\paperheight);
      \draw[anchor=north west, draw=none, fill=UHBackground.fg!60!black] (0, 0.828\paperheight-\titlefigureheight)
      rectangle (0.65\paperwidth-0.6mm, 0.828\paperheight-\titlefigureheight-1.2mm);
      \draw[anchor=north west, draw=none, fill=UHBackground.fg!40!black] (0.65\paperwidth+0.6mm, 0.828\paperheight-\titlefigureheight)
      rectangle (\paperwidth, 0.828\paperheight-\titlefigureheight-1.2mm);
      \draw[anchor=north west, fill=UHCullen.bg, draw=none] (0,0.806\paperheight-\titlefigureheight)
      rectangle (\paperwidth, 0.766\paperheight-\titlefigureheight);
      
      \ifthenelse{\equal{\beamer@UHCullen@giventitleimageC}{}}{
        \ifthenelse{\equal{\beamer@UHCullen@giventitleimageB}{}}{
          \begin{scope}[on background layer]
            \clip (2mm, 0.846\paperheight) rectangle (\paperwidth-2mm, 0.846\paperheight-\titlefigureheight);
            \node[inner sep=0, anchor=center] at (0.5\paperwidth, 0.846\paperheight-0.5\titlefigureheight) {\beamer@UHCullen@giventitleimageA};
          \end{scope}
        }{
          \begin{scope}[on background layer]
            \clip (2mm, 0.846\paperheight) rectangle (0.5\paperwidth-1mm, 0.846\paperheight-\titlefigureheight);
            \node[inner sep=0, anchor=center] at (0.25\paperwidth-0.5mm, 0.846\paperheight-0.5\titlefigureheight) {\beamer@UHCullen@giventitleimageA};
          \end{scope}
          
          \begin{scope}[on background layer]
            \clip (0.5\paperwidth+1mm, 0.846\paperheight) rectangle (\paperwidth-2mm, 0.846\paperheight-\titlefigureheight);
            \node[inner sep=0, anchor=center] at (0.75\paperwidth-0.5mm, 0.846\paperheight-0.5\titlefigureheight) {\beamer@UHCullen@giventitleimageB};
          \end{scope}
        }
      }{
        \begin{scope}[on background layer]
          \clip (2mm, 0.846\paperheight) rectangle (0.33\paperwidth-1mm, 0.846\paperheight-\titlefigureheight);
          \node[inner sep=0, anchor=center] at (0.165\paperwidth-0.5mm, 0.846\paperheight-0.5\titlefigureheight) {\beamer@UHCullen@giventitleimageA};
        \end{scope}
        
        \begin{scope}[on background layer]
          \clip (0.33\paperwidth+1mm, 0.846\paperheight) rectangle (0.66\paperwidth-1mm, 0.846\paperheight-\titlefigureheight);
          \node[inner sep=0, anchor=center] at (0.495\paperwidth, 0.846\paperheight-0.5\titlefigureheight) {\beamer@UHCullen@giventitleimageB};
        \end{scope}
        
        \begin{scope}[on background layer]
          \clip (0.66\paperwidth+1mm, 0.846\paperheight) rectangle (\paperwidth-2mm, 0.846\paperheight-\titlefigureheight);
          \node[inner sep=0, anchor=center] at (0.83\paperwidth-0.5mm, 0.846\paperheight-0.5\titlefigureheight) {\beamer@UHCullen@giventitleimageC};
        \end{scope}
      }
    \end{scope}
  
    % Title text
    \begin{scope}
      \node[anchor=north west, minimum height=2.4cm, minimum width=0pt] at (2mm, .756\paperheight-\titlefigureheight) (titlebox) {
        \begin{tikzpicture}
          \usebeamerfont{title} % set font to title font
          \node[anchor=north west, minimum height=0.6cm, align=left, inner xsep=.05cm, inner ysep=.05cm, color=title body.fg] (titlenode) {\inserttitle};
          \ifx\insertsubtitle\@empty
            \usebeamerfont{author}
            \node[anchor=north west, minimum height=.5cm, minimum width=1ex, align=left, inner xsep=.1cm, inner ysep=.1cm, color=title body.fg] at ($(titlenode.south west)+(0,-.2cm)$) (authornode) {\par\noindent\insertauthor};
          \else
            \usebeamerfont{subtitle}
            \node[anchor=north west, minimum height=.5cm, minimum width=1ex, align=left, inner xsep=.1cm, inner ysep=.1cm, color=title body.fg] at ($(titlenode.south west)+(0,-.2cm)$) (subtitlenode) {\insertsubtitle};
            \usebeamerfont{author}
            \node[anchor=north west, minimum height=.5cm, minimum width=1ex, align=left, inner xsep=.1cm, inner ysep=.1cm, color=title body.fg] at ($(subtitlenode.south west)+(0,-.05cm)$) (authornode) {\par\noindent\insertauthor};
          \fi
          \usebeamerfont{institute}
          \node[anchor=north west, minimum height=.5cm, minimum width=1ex, align=left, inner xsep=.1cm, inner ysep=.1cm, color=title body.fg] at ($(authornode.south west)+(0,-.05cm)$) (instnode) {\par\noindent\insertinstitute};
          \begin{scope}
            \ifx\insertsubtitle\@empty
              \path let \p1=(titlenode.south east),\p2=(authornode.south east),\p3=(instnode.south east) in coordinate (TitleLineLen) at ({max(\x1,\x2,\x3)}, \y1);
            \else
              \path let \p1=(titlenode.south east),\p2=(subtitlenode.south east),\p3=(authornode.south east),\p4=(instnode.south east) in coordinate (TitleLineLen) at ({max(\x1,\x2,\x3,\x4)}, \y1);
            \fi
            \draw[very thick, draw=title body.bg] ($(titlenode.south west)+(0.1cm,-0.1cm)$) -- ($(TitleLineLen)+(-0.1cm,-0.1cm)$);
          \end{scope}
        \end{tikzpicture}
      };
    \end{scope}
  
    % Logo
    \begin{scope}[on background layer]
      \node[anchor=south east] at (\paperwidth, 0) (logonode) {\includegraphics[height=1.4cm]{\beamer@UHCullen@giventitlelogo}};
    \end{scope}
  \end{tikzpicture}
}

% final page
\defbeamertemplate{final page}{text}[1]
{
  \begin{tikzpicture}
    \usebeamercolor{UHCullen}
    % Background image
    \begin{scope}[on background layer]
      \draw[fill=none, draw=none, use as bounding box] (0,0)
      rectangle (\paperwidth, \paperheight);

      \begin{scope}[on background layer]
        \clip (0.5cm, 0.5cm) rectangle (\paperwidth-0.5cm, \paperheight-0.5cm);
        \node[inner sep=0, anchor=center, minimum height=\paperheight-1cm, minimum width=\paperwidth-1cm] at (0.5\paperwidth, 0.5\paperheight) {\beamer@UHCullen@givenfinalimage};
      \end{scope}
    
      \begin{scope}[on background layer]
        \node[anchor=south west, minimum height=\paperheight-0.5cm, minimum width=\paperwidth-0.5cm] at (0.5cm, 0.5cm) (bgnode) {};
      \end{scope}
    \end{scope}

    % Final logo
    \begin{scope}
      \node[anchor=south, inner sep=0, minimum height=1cm, minimum width=0.5\paperwidth] at (bgnode.south) (finallogo) {\includegraphics[width=0.5\paperwidth]{\beamer@UHCullen@givenfinallogo}};
    \end{scope}
    \begin{scope}[on background layer]
      \draw[fill=black, opacity=0.5] ($(finallogo.south west)-(0.05\paperwidth,0)$) rectangle ($(finallogo.north east)+(0.05\paperwidth,0)$);
    \end{scope}

    % Final text
    \begin{scope}
      \node[anchor=north, inner sep=0, minimum height=4cm, minimum width=0.7\paperwidth, fill=UHCullen.bg, opacity=0.5] at ($(bgnode.north)-(0,0.8cm)$) (finalbg) {};
      \node[anchor=north, inner sep=0, minimum height=4cm, minimum width=0.7\paperwidth] at (finalbg.north) (finalnode) {
        \begin{tikzpicture}
          \usebeamerfont{thanks} % set font to thanks font
          \node[anchor=north, align=center, minimum width=5cm, minimum height=2cm, inner xsep=.05cm, color=UHCullen.fg] (finaltext) {\scalebox{2.0}{Thank you!}};
          \usebeamerfont{subthanks} % set font to sub thanks font
          \node[anchor=north, align=center, minimum width=5cm, minimum height=1cm, inner xsep=.05cm, color=UHCullen.fg] at (finaltext.south) (finalsubtext) {#1};
          \begin{scope}
            \draw[very thick, draw=UHCullen.fg] ($(finaltext.south west)+(0.1cm,0.1cm)$) -- ($(finaltext.south east)+(-0.1cm,0.1cm)$);
            \draw[very thick, draw=UHCullen.fg] ($(finalsubtext.north west)+(0.1cm,0.1cm)$) -- ($(finalsubtext.north east)+(-0.1cm,0.1cm)$);
          \end{scope}
        \end{tikzpicture}
      };
    \end{scope}
  \end{tikzpicture}
}

% Background for the title and final page.
\newcommand{\beamer@UHCullen@ClassicTitlebackground}[0]
{
  \begin{tikzpicture}[overlay]
    % Base
    \coordinate (UL) at (\Gm@lmargin,0); % upper left corner of the slide
    \coordinate (LL) at ([shift={(0, -\paperheight)}] UL); % lower left corner of the slide
    \coordinate (LR) at ([shift={(\paperwidth,-\paperheight)}] UL); %lower right corner of the slide
    \ifxetex
      \coordinate (EUL) at (0.15\paperwidth,0); % upper left corner of the slide's upper shadow
    \else
      \coordinate (EUL) at (0.15\paperwidth,0.8\paperheight); % upper left corner of the slide's upper shadow
    \fi
    \coordinate (ELR) at ([shift={(0.85\paperwidth,-0.8\paperheight)}] UL); % lower right corner of the slide's upper shadow
 
    % Background decorator and the two head lines
    \coordinate (LLdeco) at ([shift={(-0.1mm,-0.1mm)}] LL); % position of the background decorator at the lower left corner
    \coordinate (ULdeco) at ([shift={(-0.1mm,0.1mm)}] UL); % position of the background decorator at the lower left corner

    % draw the background.
    {
      \usebeamercolor{UHBackground}

      \ifdraft{}{
        % Draw the background
        \draw[draw=none,left color=UHBackground.fg,right color=UHBackground.bg,shading angle=135] (UL) rectangle (LR); % background, layer 0
        \fill[UHBackground.fg!95!black, path fading=fade center, fading angle=90] (EUL) rectangle (ELR); % background, layer 1
 
        \node[anchor=south west,inner sep=0] at (LLdeco) {\includegraphics[height=0.75\paperheight]{\beamer@UHCullen@bgdecoratorl}}; % background, decorator, lower left
        \node[anchor=north west,inner sep=0] at (ULdeco) {\includegraphics[height=0.3\paperheight]{\beamer@UHCullen@bgdecoratoru}}; % background, decorator, upper left
      }
    }
  \end{tikzpicture}
}

% define the commands used for creating title / final pages.
\providecommand{\titleframe}{
  \begingroup
  \makeatletter
  \setlength{\hoffset}{-\Gm@lmargin}
  \makeatother
  \usebackgroundtemplate{\beamer@UHCullen@ClassicTitlebackground}
  \begin{frame}[plain,noframenumbering]
    \titlepage
  \end{frame}
  \endgroup
}

\providecommand{\finalframe}[1][It's time for Q\&A.]{
  \begingroup
  \makeatletter
  \setlength{\hoffset}{-\Gm@lmargin}
  \makeatother
  \usebackgroundtemplate{\beamer@UHCullen@ClassicTitlebackground}
  \setbeamertemplate{final page}[text]{#1}
  \begin{frame}[plain,noframenumbering]
    \usebeamertemplate{final page}
  \end{frame}
  \endgroup
}

\mode<all>
