%% This is the main beamer theme file of the SPWLA 2022 theme.
%%
%% Copyright (c) 2022 by Yuchen Jin (cainmagi) <cainmagi@gmail.com>
%%
%% An unofficial template for SPWLA 2022. The style has been adjusted
%% according to the official PPT version.
%% This template is modified from Feather theme. The Feather theme
%% has been moved to handout mode.
%% ----------------
%% Mar. 3, 2022
%% - Provide \setTitleLogo and \setProgLogo.
%% - Let \setFinalImage accept an optional argument for 4:3 mode.
%% - Correct some typos.
%% ----------------
%% Mar. 2, 2022
%% - Support more palettes: feather, navy, dark, UHECE, SPWLA
%% - Use an ellipse SPWLA logo to replace the original circle logo.
%% - Provide a command for users to replace the final page background.
%% - Provide a command for users to add an optional logo.
%% - Adjust the cross reference, citation, and the footnote style.
%% - Add more extra packages for supporting more features.
%% -----------------------------
% Feather theme Copyright info:
%
% Copyright (c) 2014 by Lilyana Vaskova Vankova <lilqna.v@gmail.com>
%
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
%
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You can find the GNU General Public License at <http://www.gnu.org/licenses/>.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemeSPWLA}[2022/03/03 v1.0.5 The SPWLA 2022 Theme]

%% load required packages

% basic tier
\RequirePackage{tikz}
\RequirePackage{tcolorbox}
\RequirePackage{calc}
\RequirePackage[overload]{textcase}
\RequirePackage[nodayofweek,level]{datetime}

% advanced tier
%\usepackage[utf8]{inputenc}
\RequirePackage{csquotes}
\usepackage[T1]{fontenc}
\RequirePackage[style=ieee,citestyle=verbose,backend=bibtex]{biblatex}
\RequirePackage{cleveref}
\RequirePackage{algorithm}
\RequirePackage{algorithmic}
\RequirePackage{float}
\RequirePackage{subfigure}
\RequirePackage{siunitx}
\RequirePackage{tabularx}
\RequirePackage{array}
\RequirePackage{colortbl}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\crefname{subsection}{Subsection}{Subsections}
\def\thesubsection{\arabic{section}.\arabic{subsection}}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

%------------------------------------------
% Theme options, definitions and templates.
%------------------------------------------
\DeclareOptionBeamer{progressstyle}{\PassOptionsToPackage{progressstyle=#1}{beamerouterthemeSPWLA}}
\DeclareOptionBeamer{rotationcw}{\PassOptionsToPackage{rotationcw}{beamerouterthemeSPWLA}}
\DeclareOptionBeamer{shownavsym}{\PassOptionsToPackage{shownavsym}{beamerouterthemeSPWLA}}
\DeclareOptionBeamer{color}{\PassOptionsToPackage{color=#1}{beamercolorthemeSPWLA}}
\ProcessOptionsBeamer

%% Configure some packages
\date{\today}

%-------------------------------------------------------
% DEFFINING AND REDEFINING COMMANDS
%-------------------------------------------------------

% Hotfix for table / figure captions.
\setbeamertemplate{caption}[numbered]

% Hotfix for graphicx
\RequirePackage{ifxetex}
\ifpdf
  \RequirePackage{graphicx}
  \RequirePackage{epstopdf}
  \graphicspath{{pics/},{pic2/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  \DeclareGraphicsExtensions{.pdf,.jpeg,.png,.jpg}
\else
  \ifxetex
    \RequirePackage{graphicx}
  \else
    \RequirePackage[dvipdfmx]{graphicx}
    \RequirePackage{bmpsize}
  \fi
  \graphicspath{{pics/},{pic2/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  \DeclareGraphicsExtensions{.eps,.pdf,.jpeg,.png,.jpg}
\fi

% colored hyperlinks
\newcommand{\chref}[2]{
  \href{#1}{{\usebeamercolor[bg]{SPWLA}#2}}
}

% Hotfix for cref
\let\chyperref\cref % Save the orginal command under a new name
\renewcommand{\cref}[1]{\hyperlink{#1}{\chyperref{#1}}} % Redefine the \cref command and explictely add the hyperlink.

% Hotfix for footnotes
\let\oldfootnote\footnote
\renewcommand\footnote[1]{\oldfootnote[frame]{\scriptsize #1}}
\AtBeginEnvironment{frame}{\setcounter{footnote}{0}}

% Hotfix for hyperref
\hypersetup{pdfdisplaydoctitle={true}}
\ifpdf
  \hypersetup{pdfcreator={pdfLaTeX}}
\else
  \ifxetex
    \hypersetup{pdfcreator={xeLaTeX}}
  \else
    \hypersetup{pdfcreator={unknownLaTeX}}
  \fi
\fi

%-------------------------
% beamer specific options.
%--------------------------
\mode<presentation> %refers to the first four modes (beamer, handout, second and trans). That is, to all modes except the article mode
{
  \useinnertheme{SPWLA}
  \useoutertheme{SPWLA}
  \usecolortheme{SPWLA}
}

\mode<beamer>
{
  \hypersetup{
    pdfpagemode={FullScreen},
  }
}

\mode<all>
